{% extends "base.html" %}

{% block title %}Edit Task ‚Äì TripPlanner{% endblock %}

{% block extra_head %}
<style>
/* ============= COLOR VARIABLES ============= */
:root {
  --background: #faf9f7;
  --foreground: #1a1a1a;
  --card: #f5f3ef;
  --border: rgba(0, 0, 0, 0.08);
  --olive-green: #6b7455;
  --olive-green-light: #8b9474;
  --olive-green-subtle: #a8b193;
  --beige-card: #f5f3ef;
  --off-white: #faf9f7;
  --warm-gray: #8a8884;
  --destructive: #d4183d;
}

.edit-task-page {
  background: linear-gradient(135deg, var(--off-white) 0%, var(--beige-card) 100%);
  min-height: 100vh;
}

.edit-form {
  background: linear-gradient(135deg, var(--card) 0%, var(--off-white) 100%);
  border: 1px solid var(--olive-green-subtle);
  box-shadow: 0 2px 8px rgba(107, 116, 85, 0.1);
}

.edit-form input, .edit-form textarea, .edit-form select {
  border: 1px solid var(--olive-green-subtle);
  background: var(--card);
}

.edit-form input:focus, .edit-form textarea:focus, .edit-form select:focus {
  border-color: var(--olive-green);
  outline: none;
  box-shadow: 0 0 0 2px rgba(107, 116, 85, 0.1);
}

.btn-primary {
  background: var(--olive-green);
  border-color: var(--olive-green);
}

.btn-primary:hover {
  background: var(--olive-green-light);
}
</style>
{% endblock %}

{% block content %}

<div class="edit-task-page">

    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <span class="breadcrumb-icon">üè†</span>
        <a href="/dashboard" class="breadcrumb-link">Dashboard</a>
        <span class="breadcrumb-sep">‚Üí</span>
        <a href="/trips" class="breadcrumb-link">Trips</a>
        <span class="breadcrumb-sep">‚Üí</span>
        <a href="/trip/{{ trip.id }}" class="breadcrumb-link">{{ trip.name }}</a>
        <span class="breadcrumb-sep">‚Üí</span>
        <a href="/trip/{{ trip.id }}/day/{{ day.id }}" class="breadcrumb-link">{{ day.date }}</a>
        <span class="breadcrumb-sep">‚Üí</span>
        <span class="breadcrumb-current">Edit Task</span>
    </div>

    <header class="edit-header">
        <h1>Edit Task</h1>
        <p>{{ trip.name }} ¬∑ {{ day.date }}</p>
    </header>

    <form method="POST" class="edit-form">

        <label>
            Task Title
            <input type="text" name="title"
                   value="{{ task.title }}" required>
        </label>

        <label>
            Start Time
            <input type="time" name="start_time"
                   value="{{ task.start_time }}" required>
        </label>

        <label>
            End Time
            <input type="time" name="end_time"
                   value="{{ task.end_time }}" required>
        </label>

        <label>
            Description (Optional)
            <textarea name="description" rows="3" placeholder="Additional details about this task...">{{ task.description or '' }}</textarea>
        </label>

        <label>
            Latitude (Optional)
            <input type="number" step="any" name="lat"
                   value="{{ task.lat or '' }}">
        </label>

        <label>
            Longitude (Optional)
            <input type="number" step="any" name="lng"
                   value="{{ task.lng or '' }}">
        </label>

        <button type="submit" class="btn primary">Save Changes</button>

        <a class="cancel-link"
           href="/trip/{{ trip.id }}/day/{{ day.id }}">
            Cancel
        </a>

    </form>

</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Get user's current location for lat/lng
function getCurrentLocation() {
    if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(function(position) {
            document.querySelector('input[name="lat"]').value = position.coords.latitude.toFixed(6);
            document.querySelector('input[name="lng"]').value = position.coords.longitude.toFixed(6);
        });
    }
}

// Add button to get current location
document.querySelector('input[name="lat"]').insertAdjacentHTML('afterend', 
    '<button type="button" onclick="getCurrentLocation()" style="margin-top: 0.5rem;" class="btn small neutral">Use Current Location</button>'
);

// Show current location on map if available
function showOnMap() {
    const lat = document.querySelector('input[name="lat"]').value;
    const lng = document.querySelector('input[name="lng"]').value;
    
    if (lat && lng) {
        const url = `https://www.google.com/maps?q=${lat},${lng}`;
        window.open(url, '_blank');
    }
}

// Add button to view on map if coordinates exist
const latInput = document.querySelector('input[name="lat"]');
const lngInput = document.querySelector('input[name="lng"]');

function updateMapButton() {
    const existingButton = document.getElementById('map-button');
    if (existingButton) {
        existingButton.remove();
    }
    
    if (latInput.value && lngInput.value) {
        lngInput.insertAdjacentHTML('afterend', 
            '<button type="button" id="map-button" onclick="showOnMap()" style="margin-top: 0.5rem;" class="btn small ghost">üó∫Ô∏è View on Map</button>'
        );
    }
}

latInput.addEventListener('input', updateMapButton);
lngInput.addEventListener('input', updateMapButton);

// Initialize map button
updateMapButton();
</script>
{% endblock %}